var r=class{constructor(){this.events={}}on(t,i){this.events[t]||(this.events[t]=[]),this.events[t].push(i)}emit(t,i){this.events[t]&&this.events[t].forEach(s=>s(i)),t!="*"&&setTimeout(()=>this.emit("*",t,i),1)}off(t,i){this.events[t]&&(this.events[t]=this.events[t].filter(s=>s!==i))}};var l=class extends r{constructor(t,i,s,o){super(),this.name=t,this.defaultState=this.currentState=i,this.states=s,this.context=o}transition(t){let i=this.states[this.currentState],s=i.events[t];if(s&&this.states[s]){i.exit&&i.exit.call(this,i.output),this.currentState=s;let o=this.states[s];o.entry&&(o.output=o.entry.call(this,this.handleEvent.bind(this)))}else s&&(this.emit(s),this.currentState=this.defaultState)}handleEvent(t){this.transition(t)}};var a=100,h=500;var c=class e extends r{constructor(t){super(),this.sm=new l("Button","Idle",e.stateMap,t),setWatch(()=>this.sm.handleEvent("_button_pressed"),BTN,{repeat:!0,edge:"rising",debounce:50}),setWatch(()=>this.sm.handleEvent("_button_released"),BTN,{repeat:!0,edge:"falling",debounce:50}),this.sm.on("*",i=>this.emit(i))}};c.stateMap={Idle:{events:{_button_pressed:"_PressDetected"},entry:()=>{LED1.write(0),LED2.write(0),LED3.write(0)}},_PressDetected:{events:{_button_released:"_ReleaseBeforeTimeout",_timeout_longClick:"LongClick"},entry:function(e){return setTimeout(()=>e("_timeout_longClick"),h)},exit:clearTimeout},_ReleaseBeforeTimeout:{events:{_button_pressed:"_SecondPressDetected",_timeout_click:"SingleClick"},entry:function(e){return setTimeout(()=>e("_timeout_click"),a)},exit:clearTimeout},_SecondPressDetected:{events:{_button_released:"_ReleaseSecondPressBeforeTimeout",_timeout_longDoubleClick:"LongDoubleClick"},entry:function(e){return setTimeout(()=>e("_timeout_longDoubleClick"),h)},exit:clearTimeout},_ReleaseSecondPressBeforeTimeout:{events:{_button_pressed:"_ThirdPressDetected",_timeout_doubleClick:"DoubleClick"},entry:function(e){return setTimeout(()=>e("_timeout_doubleClick"),a)},exit:clearTimeout},_ThirdPressDetected:{events:{_button_released:"_ReleaseThirdPressBeforeTimeout",_timeout_longTripleClick:"LongTripleClick"},entry:function(e){return setTimeout(()=>e("_timeout_longTripleClick"),h)},exit:clearTimeout},_ReleaseThirdPressBeforeTimeout:{events:{_timeout_tripleClick:"TripleClick"},entry:function(e){return setTimeout(()=>e("_timeout_tripleClick"),a)},exit:clearTimeout}};var T=100;function n(e,t){e.write(1),setTimeout(()=>{t&&t("_timeout_idle")},T)}var u=class e{constructor(t){this.sm=new l("Click","Idle",e.stateMap,t),this.sm.int=require("ble_hid_combo"),t.resetLEDs=()=>{LED1.write(0),LED2.write(0),LED3.write(0)},this.button=new c(t),this.button.on("*",i=>{this.sm.handleEvent(i),this.sm.emit(i)}),t.resetLEDs()}};u.stateMap={Idle:{events:{SingleClick:"SingleClick",DoubleClick:"DoubleClick",LongClick:"LongClick",LongDoubleClick:"LongDoubleClick",TripleClick:"TripleClick",LongTripleClick:"LongTripleClick"},entry:function(){this.context.resetLEDs()}},SingleClick:{events:{_timeout_idle:"Idle"},entry:function(e){switch(n(LED1,e),this.context.mode){case"pageupdown":this.context.enableHid&&this.int.tapKey(this.int.KEY.PAGE_DOWN);break;case"rightleft":this.context.enableHid&&this.int.tapKey(this.int.KEY.RIGHT)}}},DoubleClick:{events:{_timeout_idle:"Idle"},entry:function(e){switch(n(LED2,e),this.context.mode){case"pageupdown":this.context.enableHid&&this.int.tapKey(this.int.KEY.PAGE_UP);break;case"rightleft":this.context.enableHid&&this.int.tapKey(this.int.KEY.LEFT)}}},TripleClick:{events:{_timeout_idle:"Idle"},entry:function(e){n(LED1,e),n(LED2,e)}},LongClick:{events:{MouseControl:"MouseControl"},entry:function(e){e("MouseControl")}},MouseControl:{events:{LongClick:"Idle"},entry:function(e){Puck.accelOn(104),this.clickHandler=()=>{this.context.enableHid&&(this.int.clickButton(this.int.BUTTON.LEFT),this.int.releaseButton(this.int.BUTTON.LEFT))},this.on("SingleClick",this.clickHandler),n(LED3)},exit:function(e){this.off("SingleClick",this.clickHandler),Puck.accelOff()}},LongDoubleClick:{events:{_timeout_idle:"Idle"},entry:function(e){this.context.mode=this.context.mode=="pageupdown"?"rightleft":"pageupdown",n(LED1,e),n(LED2,e),n(LED3,e)}},LongTripleClick:{events:{_timeout_idle:"Idle"},entry:function(e){n(LED2,e),n(LED3,e)}}};function d(e,t){let i;return function(){let s=arguments,o=this;if(!i)return e.apply(o,s),i=!0,setTimeout(()=>i=!1,t)}}var g=require("ble_hid_combo");NRF.setServices({6159:{10777:{value:[Math.round(Puck.getBatteryPercentage())],readable:!0,notify:!0,description:"Battery Level"}}},{hid:g.report});NRF.setAdvertising({},{name:"dashClicker",showName:!0,discoverable:!0,services:[6159]});function C(){NRF.setServices({6159:{10777:{value:[Math.round(Puck.getBatteryPercentage())],readable:!0,notify:!0,description:"Battery Level"}}})}setInterval(C,6e4);var _={},D={mode:"pageupdown",enableHid:!0};function L(){Object.assign(_,D)}L();new u(_);var m=0,f=0,p=.5,k=.01;Puck.on("accel",d(e=>{let t=m+Math.floor(p*(e.gyro.x*k-m)),i=f+Math.floor(p*(e.gyro.y*k-f));m=t,f=i,_.enableHid&&g.moveMouse(t,-i)},10));
